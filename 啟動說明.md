# 🚀 光復 e 互助平台 - 啟動指南

## ✅ 問題診斷結果

**已修復的問題：**

1. ✅ `reporting_service.py` 的程式碼重複和縮排錯誤
2. ✅ 資料庫初始化問題
3. ✅ Windows Reload 模式衝突（改用標準模式）

**根本原因：**

- Windows 環境下 uvicorn 的 `--reload` 模式與 multiprocessing 有衝突
- 使用標準模式啟動即可正常運行

---

## 🎯 快速啟動（推薦）

### 方法一：雙擊批次檔

直接雙擊 `run.bat` 檔案

### 方法二：命令行啟動

```powershell
.\run.bat
```

---

## 📍 訪問服務

啟動成功後，可以訪問以下網址：

| 服務                      | 網址                               | 說明            |
| ------------------------- | ---------------------------------- | --------------- |
| 🏠 **首頁**               | http://localhost:8000/             | API 基本資訊    |
| ❤️ **健康檢查**           | http://localhost:8000/health       | 服務狀態        |
| 📚 **API 文件 (Swagger)** | http://localhost:8000/api/v1/docs  | 互動式 API 文件 |
| 📖 **API 文件 (ReDoc)**   | http://localhost:8000/api/v1/redoc | 美化版 API 文件 |

---

## 🔧 開發模式啟動

如果需要修改程式碼後自動重載（開發時使用）：

### Windows PowerShell 方式：

```powershell
# 設置環境變數避免 reload 問題
$env:PYTHONPATH = "."
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --reload-delay 2
```

### 直接使用 Python：

```powershell
python -c "import uvicorn; uvicorn.run('app.main:app', host='0.0.0.0', port=8000, reload=False)"
```

---

## 🗄️ 資料庫管理

### 初始化資料庫

```powershell
python scripts\init_database.py
```

### 重置資料庫（清空所有資料）

```powershell
python scripts\init_database.py --reset
```

### 資料庫位置

- **檔案**: `disaster_relief.db` (SQLite)
- **類型**: 開發環境使用 SQLite

---

## 🧪 測試 API

### 使用 curl 測試

```powershell
# 健康檢查
curl http://localhost:8000/health

# 獲取 API 資訊
curl http://localhost:8000/

# 查看使用者列表（需要登入）
curl http://localhost:8000/api/v1/users
```

### 使用瀏覽器

直接訪問 http://localhost:8000/api/v1/docs 使用互動式文件測試

---

## 🔑 初始設定

### 創建管理員帳號

```powershell
# 使用 API 文件註冊
# 訪問 http://localhost:8000/api/v1/docs
# 找到 POST /api/v1/auth/register 端點
```

### 環境變數設定

編輯 `.env` 檔案：

```env
# 資料庫設定
ENVIRONMENT=development
DEBUG=true

# JWT 設定
JWT_SECRET_KEY=your-secret-key-here
ACCESS_TOKEN_EXPIRE_MINUTES=11520

# 外部服務（選用）
GOOGLE_MAPS_API_KEY=your-api-key
LINE_NOTIFY_TOKEN=your-token
```

---

## ❌ 停止服務

在執行 `run.bat` 的視窗中按 `Ctrl+C` 即可停止

或使用 PowerShell：

```powershell
Stop-Process -Name "python" -Force
```

---

## 🐛 常見問題排除

### 問題 1: 埠號被佔用

```
Error: Address already in use
```

**解決方法：**

```powershell
# 查找佔用 8000 port 的程式
netstat -ano | findstr :8000

# 停止該程式（替換 PID）
taskkill /PID <PID> /F
```

### 問題 2: 模組導入錯誤

```
ModuleNotFoundError: No module named 'xxx'
```

**解決方法：**

```powershell
# 安裝依賴
pip install -r requirements.txt
```

### 問題 3: 資料庫錯誤

```
OperationalError: table already exists
```

**解決方法：**

```powershell
# 重置資料庫
python scripts\init_database.py --reset
```

---

## 📦 完整重新安裝

如果遇到無法解決的問題：

```powershell
# 1. 清理環境
Remove-Item -Recurse -Force venv
Remove-Item disaster_relief.db

# 2. 重新建立虛擬環境（選用）
python -m venv venv
.\venv\Scripts\Activate.ps1

# 3. 安裝依賴
pip install -r requirements.txt

# 4. 初始化資料庫
python scripts\init_database.py

# 5. 啟動服務
.\run.bat
```

---

## 📚 更多資訊

- **專案文件**: `README.md`
- **資料庫文件**: `docs/database_models.md`
- **設計文件**: `.kiro/specs/disaster-relief-platform/design.md`
- **API 文件**: http://localhost:8000/api/v1/docs（服務啟動後）

---

## ✨ 快速測試流程

1. ✅ **啟動服務**: 執行 `run.bat`
2. ✅ **檢查狀態**: 訪問 http://localhost:8000/health
3. ✅ **查看文件**: 訪問 http://localhost:8000/api/v1/docs
4. ✅ **註冊帳號**: 使用 API 文件的 `/auth/register` 端點
5. ✅ **登入系統**: 使用 `/auth/login` 端點獲取 Token
6. ✅ **測試功能**: 使用 Token 測試其他 API

---

**祝您使用愉快！** 🎊
